
\section{Introduction}

In the spirit of \citet{burge1975recursive}, this document collects our effort
to make into practice what Burge describes in the first half of Chapter $3$ in
his book -- for your humble author, it is a collection of seminal idea now
available in present functional programming languages, by the way. For this
reason, much of the content has been borrowed from that chapter and extended
using recent outstanding references, such as \citet{sedgewick2014introduction}
and the more ambitious work of \citet{flajolet2009analytic}.

Our contribution is a practical implementation using the Python language of the
abstract ideas introduced by the referenced authors, which aims \emph{to
automate the computation of generating functions (both ordinary and
exponential) for arbitrary compositions of types}; moreover, the interleave of
symbolic manipulation with the usual functional style allows us to obtain
counting formulae in closed form.

This work is an extended exercise on understanding basic concepts of
combinatorial analysis, drawing and inspired by
\citet{riordan2002introduction}, to further combine to form a coherent
language; eventually, we wish to \textit{use generating functions as a true
enumeration device by a tight integration with symbolic programming}, not just
for its counting capabilities which say nothing about the structure of actual
objects being counted.

How to read this document: words in \texttt{monospace font} represent Python
code that can be typed and evaluated in a Python 3 interpreter while the
results of the execution are reported in the lines immediately below formatted
according to their nature, usually using standard \TeX\, math symbols. In the
prose we introduce and describe classes of Python objects that implement the
desired theory, postponing their precise definitions in Section
\ref{sec:appendix}. Moreover, we assume that the bindings
\begin{minted}[baselinestretch=0.8]{python}
x,y,m,n,t,z = symbols('x y m n t z')
alpha, beta, gamma, eta = symbols(r'\alpha \beta \gamma \eta')
f,g = Function('f'), Function('g')
w = IndexedBase('w')
\end{minted}
last till the end of this work and they are in scope for all definitions, finally
the variable $z$ will be reserved for counting with respect to the number of
atomic objects within a combinatorial structure.

\section{Syntax and semantic}

The type system subject of our study is defined by the grammar
\begin{definition}[Syntax]
\begin{displaymath}
\begin{split}
\Gamma\quad::=\quad&\tyunit\indent\textit{(empty type)} \\
             |\quad&\textbf{tyvar}\,\mathcal{V}_{z}\indent\textit{(type variable)} \\
             |\quad&\typarens{\Gamma}\indent\textit{(precedence)} \\
             |\quad&\tydu{\Gamma}{\Gamma}\indent\textit{(disjoint union)} \\
             |\quad&\tycp{\Gamma}{\Gamma}\indent\textit{(cartesian product)} \\
             %|\quad&\Gamma\,\times_{b}\,\Gamma\indent\textit{(binomial product)} \\
             |\quad&\textbf{rec}\,\mathcal{V}.\,\Gamma\indent\textit{(recursion)} \\
             |\quad&\mathcal{F}(\,\Gamma\,)\indent\textit{(transformation)} \\
             %|\quad&-\,\Gamma\indent\textit{(negation)} \\
             %|\quad&2^{\Gamma}\indent\textit{(set of all finite subsets)} \\
             %|\quad&(-2)^{\Gamma}\indent\textit{(derangements)} \\
             %|\quad&\sim\Gamma\indent\textit{(cycles)} \\
             |\quad&\partial\,{\Gamma}\indent\textit{(derivation)} \\
             |\quad&\int{\Gamma}\indent\textit{(integration)} \\
             |\quad&\Gamma\,\Gamma\indent\textit{(application)} \\
\end{split}
\end{displaymath}
where $\mathcal{V}_{z} = \lbrace v\,z^{i}:v\in\mathcal{V}^{+}
\rbrace_{i\in\mathbb{N}}$ is built on $\mathcal{V}=  \lbrace v_{i}
\rbrace_{i\in\mathbb{N}}$, which is a \textit{countable} set of pure symbols;
moreover, $\mathcal{F}$ is a set of continuous and differentiable (infinitely
many times) functions over $\mathbb{Z}[z]$, namely  $\mathcal{F} = \lbrace
f\,\in\,C^{\infty}(\mathbb{Z}[z], \mathbb{Z}[z])\rbrace$.
\end{definition}

In what follow, we stick to the habit that uses greek symbols to denote type
variables. The following conventions are in order: (i)~operators $\cup$ and
$\times$ associate to the right, $(a \cup b \cup c)$ and $(a \times b
\times d)$ denote $\left(a \cup (b \cup c)\right)$ and $(a \times (b
\times d))$ respectively; on the other hand, the application $a\,b\,c$
associates to the left, namely $(a\,b)\,c$ as in currified function
applications.

We give meaning to the introduced syntax by
\begin{definition}[Semantic]
The semantic function $\semantic{}: \Gamma \rightarrow
\mathbb{Z}[z]$ is defined by structural induction for terms in $\Gamma$,
\begin{displaymath}
\begin{split}
    \semantic{\tyunit} &= 1 \\
    \semantic{\tyvar{\gamma}} &= \gamma\indent\textit{(observe that $\gamma$ may contain powers of $z$)} \\
    \semantic{\typarens{\gamma}} &= \semantic{\gamma}\\
    \semantic{\tydu{a}{b}} &= \semantic{a} + \semantic{b} \\
    \semantic{\tycp{a}{b}} &= \semantic{a}\cdot\semantic{b} \\
    %\semantic{a\,\times_{b}\,c} &= \semantic{a}\star\semantic{c} \\
    \semantic{\textbf{rec}\,\gamma.\,a} &= \beta(z)  \quad\text{where}\quad
        %\semantic{\textbf{tyvar}\,\gamma}\,=_{\beta}\,\semantic{a\,[\textbf{tyvar}\,\gamma/\gamma]}\\
        \semantic{\textbf{tyvar}\,\gamma}\,=_{\beta(z)}\,\semantic{a}\\
    %\semantic{-\,a} &= -\,\semantic{a}\\
    %\semantic{2^{a}} &= e^{\semantic{a}}\\
    %\semantic{(-2)^{a}} &= \frac{e^{-\beta}}{1-\beta}\quad\text{where}\quad\beta=\semantic{a}(z)\\
    %\semantic{\sim a} &= log\,\semantic{a}\\
    \semantic{f(\,a\,)} &= f(\,\semantic{a}\,)\indent\textit{(recall that $f\,:\,\mathbb{Z}[z]\rightarrow\mathbb{Z}[z]$)}\\
    \semantic{\partial\,a} &= \frac{\partial}{\partial\,z}\,\semantic{a}\\
    \semantic{\int{a}} &= \int{\semantic{a}\,dz}\\
    \semantic{a\,b} &= \semantic{a}\big|_{z=\semantic{b}}\\
\end{split}
\end{displaymath}
denoting with $a\,=_{\beta}\,b(a)$ that $\beta$ is the solution of the equation
$a\,=\,b(a)$ with respect to $a$; moreover, the operator $c\,\big|_{a=b}$
substitutes every occurrence of $a$ expressions with the $b$ expression in the
context expression $c$.
\end{definition}

In plain words, $\semantic{a}$ yields  the \textit{generating function} that
counts the number of atomic objects in values of type $a$; in particular, the
coefficient $a_{n}$ of $z^{n}$ in the series expansion of $\semantic{a}$, in
symbols $[z^{n}]\,\semantic{a} = a_{n}$, counts the number of atomic objects
within a value of dimension $n$ with type $a\in\Gamma$ -- the operator
$[z^{n}]$ is studied in depth by \citet{MSV07}.

Precisely, the semantic of the cartesian product type
$\tycp{\Gamma}{\Gamma}$ is defined as the Cauchy convolution
\begin{displaymath}
    \semantic{a}\cdot\semantic{b} = \sum_{n\in\mathbb{N}}{\left(\sum_{k=0}^{n}{a_{k}b_{n-k}}\right)\,z^{n}},
\end{displaymath}
to which the binomial product type $\Gamma\,\times_{b}\,\Gamma$ can be reduced by
\begin{displaymath}
\begin{split}
    \semantic{a}\star\semantic{b}
        &= \sum_{n\in\mathbb{N}}{\left(\sum_{k=0}^{n}{{ {n}\choose{k} }a_{k}b_{n-k}}\right)\,\frac{z^{n}}{n!}}
         = \sum_{n\in\mathbb{N}}{\left(\sum_{k=0}^{n}{\frac{a_{k}}{k!}\,\frac{b_{n-k}}{(n-k)!}}\right)\,z^{n}} \\
        &= \semantic{\hat{a}}\cdot\semantic{\hat{b}} \quad\text{where}\quad[t^{n}]\semantic{\hat{c}} = \frac{1}{n!}\,[t^{n}]\semantic{c},
\end{split}
\end{displaymath}
allows us to manipulate both ordinary and exponential generating functions,
enumerating \textit{unlabelled} and \textit{labelled} objects respectively.

\section{Enumerations and boxes}

The enumeration of a type $a\in\Gamma$ can (i)~be unified and generalized using
their semantic $\semantic{a}$ and can (ii)~be interpreted in terms of boxes and
placements of objects in them; for the sake of clarity, for us \textit{a box is
a configuration of a (possibly infinite) collection of cells} and it can be represented graphically as
\begin{displaymath}
\underbrace{\underbrace{\quad}_{\textit{a cell}}\quad\underbrace{\quad}_{\textit{another cell}}\quad\cdots}_{\textit{a box}}
\end{displaymath}
finally, a \textit{cell holds either an atomic object or another box}. The
connection among a type $a\in\Gamma$ and a box $B$ is that $a$ defines the
configuration of the cells within $B$, namely $\displaystyle
\underbrace{a\in\Gamma}_{\textit{box }\,B}$.  Starting small, the two primitive types
$\tyunit$ and $\tyvar{(\alpha\,z)}$ denotes the boxes $E$ and $O$, graphically depicted as
\begin{displaymath}
\underbrace{\underbrace{1}_{\textit{a cell}}}_{\textit{box E}}\quad\text{and}\quad
\underbrace{\underbrace{\alpha}_{\textit{a cell}}}_{\textit{box O}},
\end{displaymath}
which both indicate a box having one cell that is empty and holds \textit{one}
object of type $\alpha$, respectively.  Therefore, when we write down a type,
we give the configuration of a box, namely types represent selections of
objects to fullfil cells in that box.

\begin{definition}[\tytruth, \tyfalsehood, \tyboolean]
Types that represent truth, falsehood and boolean are in order,
\begin{displaymath}
\begin{split}
    \Gamma\quad::=\quad&... \\
           |\quad&\tydef{\tytruth}{\tyvar{w_{1}\,z}}{logical success}\\
           |\quad&\tydef{\tyfalsehood}{\tyvar{w_{0}\,z}}{logical failure}\\
           |\quad&\tydef{\tyboolean}{\tydu{\tytruth}{\tyfalsehood}}{logical choice}\\
\end{split}
\end{displaymath}
with semantic
\begin{displaymath}
\begin{split}
    \semantic{\tytruth} &= w_{1}\,z\\
    \semantic{\tyfalsehood} &= w_{0}\,z\\
    \semantic{\tyboolean} &= (w_{1} + w_{0})\,z,
\end{split}
\end{displaymath}
respectively.
\end{definition}

\begin{example}
Let $\alpha\in\mathcal{V}$ and consider the type
\begin{displaymath}
    \tydu{\tyunit}{\tyvar{\alpha\,z}}
\end{displaymath}
whose generating function can be found by the semantic
\begin{displaymath}
    \semantic{\tydu{\tyunit}{\tyvar{\alpha\,z}}} = 1 + \alpha\,z
\end{displaymath}
which represents the possibility to choose an element of type \tyvar{\alpha} or
to choose nothing.
\end{example}

Previous examples is only the beginning and the following one connects
the boxes analogy with a problem about powers of natural numbers.

\begin{example}
Enumerate all numbers that can be written as sum of powers of $2$, $3$ and $5$
respectively, using at most $4$ powers of each, in that case a single time.
The answer lies in the semantic
\begin{displaymath}
\semantic{\tycp{a}{\tycp{b}{\tycp{c}{d}}}} = \left(z^{b^{0}} {\space}_{b^{0}} + 1\right) \left(z^{b^{1}} {\space}_{b^{1}} + 1\right) \left(z^{b^{2}} {\space}_{b^{2}} + 1\right) \left(z^{b^{3}} {\space}_{b^{3}} + 1\right),
\end{displaymath}
where
\begin{displaymath}
\begin{split}
    a &= \typarens{\tydu{\tyunit}{\tyvar{{\space}_{b^{0}} z^{b^{0}}}}},
        b = \typarens{\tydu{\tyunit}{\tyvar{{\space}_{b^{1}} z^{b^{1}}}}},\\
    c &= \typarens{\tydu{\tyunit}{\tyvar{{\space}_{b^{2}} z^{b^{2}}}}}\quad\text{and}\quad
        d = \typarens{\tydu{\tyunit}{\tyvar{{\space}_{b^{3}} z^{b^{3}}}}},
\end{split}
\end{displaymath}
and its series expansion with respect to $z$ enumerates (i)~for $b=2$,
\begin{displaymath}
\begin{split}
&z^{15} {\space}_{2^{0}} {\space}_{2^{1}} {\space}_{2^{2}} {\space}_{2^{3}} + z^{14} {\space}_{2^{1}} {\space}_{2^{2}} {\space}_{2^{3}} + z^{13} {\space}_{2^{0}} {\space}_{2^{2}} {\space}_{2^{3}} + z^{12} {\space}_{2^{2}} {\space}_{2^{3}} + z^{11} {\space}_{2^{0}} {\space}_{2^{1}} {\space}_{2^{3}} + z^{10} {\space}_{2^{1}} {\space}_{2^{3}} + z^{9} {\space}_{2^{0}} {\space}_{2^{3}} + \\
&z^{8} {\space}_{2^{3}} + z^{7} {\space}_{2^{0}} {\space}_{2^{1}} {\space}_{2^{2}} + z^{6} {\space}_{2^{1}} {\space}_{2^{2}} + z^{5} {\space}_{2^{0}} {\space}_{2^{2}} + z^{4} {\space}_{2^{2}} + z^{3} {\space}_{2^{0}} {\space}_{2^{1}} + z^{2} {\space}_{2^{1}} + z {\space}_{2^{0}} + 1;
\end{split}
\end{displaymath}
(ii)~for $b=3$,
\begin{displaymath}
\begin{split}
&z^{40} {\space}_{3^{0}} {\space}_{3^{1}} {\space}_{3^{2}} {\space}_{3^{3}} + z^{39} {\space}_{3^{1}} {\space}_{3^{2}} {\space}_{3^{3}} + z^{37} {\space}_{3^{0}} {\space}_{3^{2}} {\space}_{3^{3}} + z^{36} {\space}_{3^{2}} {\space}_{3^{3}} + z^{31} {\space}_{3^{0}} {\space}_{3^{1}} {\space}_{3^{3}} + z^{30} {\space}_{3^{1}} {\space}_{3^{3}} + z^{28} {\space}_{3^{0}} {\space}_{3^{3}} + \\
&z^{27} {\space}_{3^{3}} + z^{13} {\space}_{3^{0}} {\space}_{3^{1}} {\space}_{3^{2}} + z^{12} {\space}_{3^{1}} {\space}_{3^{2}} + z^{10} {\space}_{3^{0}} {\space}_{3^{2}} + z^{9} {\space}_{3^{2}} + z^{4} {\space}_{3^{0}} {\space}_{3^{1}} + z^{3} {\space}_{3^{1}} + z {\space}_{3^{0}} + 1;
\end{split}
\end{displaymath}
(iii)~for $b=5$,
\begin{displaymath}
\begin{split}
&z^{156} {\space}_{5^{0}} {\space}_{5^{1}} {\space}_{5^{2}} {\space}_{5^{3}} + z^{155} {\space}_{5^{1}} {\space}_{5^{2}} {\space}_{5^{3}} + z^{151} {\space}_{5^{0}} {\space}_{5^{2}} {\space}_{5^{3}} + z^{150} {\space}_{5^{2}} {\space}_{5^{3}} + z^{131} {\space}_{5^{0}} {\space}_{5^{1}} {\space}_{5^{3}} + z^{130} {\space}_{5^{1}} {\space}_{5^{3}} + z^{126} {\space}_{5^{0}} {\space}_{5^{3}} + \\
&z^{125} {\space}_{5^{3}} + z^{31} {\space}_{5^{0}} {\space}_{5^{1}} {\space}_{5^{2}} + z^{30} {\space}_{5^{1}} {\space}_{5^{2}} + z^{26} {\space}_{5^{0}} {\space}_{5^{2}} + z^{25} {\space}_{5^{2}} + z^{6} {\space}_{5^{0}} {\space}_{5^{1}} + z^{5} {\space}_{5^{1}} + z {\space}_{5^{0}} + 1
\end{split}
\end{displaymath}
and (iv)~for $b=7$,
\begin{displaymath}
\begin{split}
&z^{400} {\space}_{7^{0}} {\space}_{7^{1}} {\space}_{7^{2}} {\space}_{7^{3}} + z^{399} {\space}_{7^{1}} {\space}_{7^{2}} {\space}_{7^{3}} + z^{393} {\space}_{7^{0}} {\space}_{7^{2}} {\space}_{7^{3}} + z^{392} {\space}_{7^{2}} {\space}_{7^{3}} + z^{351} {\space}_{7^{0}} {\space}_{7^{1}} {\space}_{7^{3}} + z^{350} {\space}_{7^{1}} {\space}_{7^{3}} + z^{344} {\space}_{7^{0}} {\space}_{7^{3}} + \\
&z^{343} {\space}_{7^{3}} + z^{57} {\space}_{7^{0}} {\space}_{7^{1}} {\space}_{7^{2}} + z^{56} {\space}_{7^{1}} {\space}_{7^{2}} + z^{50} {\space}_{7^{0}} {\space}_{7^{2}} + z^{49} {\space}_{7^{2}} + z^{8} {\space}_{7^{0}} {\space}_{7^{1}} + z^{7} {\space}_{7^{1}} + z {\space}_{7^{0}} + 1,
\end{split}
\end{displaymath}
respectively; for the sake of clarity, $z^{393} {\space}_{7^{0}} {\space}_{7^{2}}
{\space}_{7^{3}}$ proves that $393 = 7^{0} + 7^{2} + 7^{3}$.
\end{example}

\begin{definition}[\tymaybe{\gamma}]
The generalization of the previous type is so fundamental that we stick to it a name
\begin{displaymath}
\begin{split}
    \Gamma\quad::=\quad&... \\
           |\quad&\tydef{\tymaybe{\Gamma}}{\tydu{\tyvar{␣}}{\Gamma}}{possible occurrence}
\end{split}
\end{displaymath}
with semantic
\begin{displaymath}
    \semantic{\tymaybe{a}} = ␣\,+\,\semantic{a},
\end{displaymath}
namely $\tymaybe{a}$ says that \textit{an object of type $a$
may not or may appear in a box configuration}.
\end{definition}

Using the types seen so far it is possible to tackle some occupancy problems,
as follows in the next examples.

\begin{example}
What's the occupancy configurations of $4$ boxes using $4$ objects
$o_{0}$,$o_{1}$,$o_{2}$ and $o_{3}$, where each object may not or may be
selected for placement?

The answer lies in the semantic
\begin{displaymath}
    \semantic{\tycp{a}{\tycp{b}{\tycp{c}{d}}}} = \left(z o_{0} + ␣\right) \left(z o_{1} + ␣\right) \left(z o_{2} + ␣\right) \left(z o_{3} + ␣\right)
    \quad\text{where}
\end{displaymath}
\begin{displaymath}
\begin{split}
a&={\tymaybe{\typarens{\tyvar{o_{0}\,z}}}}, b={\tymaybe{\typarens{\tyvar{o_{1}\,z}}}},\\
c&={\tymaybe{\typarens{\tyvar{o_{2}\,z}}}}\quad\text{and}\quad d={\tymaybe{\typarens{\tyvar{o_{3}\,z}}}},
\end{split}
\end{displaymath}
and its series expansion with respect to $z$ enumerates as follows,
according to the cases (i)~\textit{unlike objects in unlike boxes}
\begin{displaymath}
\begin{split}
&z^{4} o_{0} o_{1} o_{2} o_{3} + \\
&z^{3} \left(o_{0} o_{1} o_{2} ␣ + o_{0} o_{1} ␣ o_{3} + o_{0} ␣ o_{2} o_{3} + ␣ o_{1} o_{2} o_{3}\right) +\\
&z^{2} \left(o_{0} o_{1} ␣^{2} + o_{0} ␣ o_{2} ␣ + o_{0} ␣^{2} o_{3} + ␣ o_{1} o_{2} ␣ + ␣ o_{1} ␣ o_{3} + ␣^{2} o_{2} o_{3}\right) + \\
&z \left(o_{0} ␣^{3} + ␣ o_{1} ␣^{2} + ␣^{2} o_{2} ␣ + ␣^{3} o_{3}\right) +\\
&␣^{4};
\end{split}
\end{displaymath}
(ii)~\textit{unlike objects in like boxes}
\begin{displaymath}
\begin{split}
&u_{0} u_{1} u_{2} u_{3} z^{4} + \\
&z^{3} \left(u_{0} u_{1} u_{2} ␣ + u_{0} u_{1} u_{3} ␣ + u_{0} u_{2} u_{3} ␣ + u_{1} u_{2} u_{3} ␣\right) + \\
&z^{2} \left(u_{0} u_{1} ␣^{2} + u_{0} u_{2} ␣^{2} + u_{0} u_{3} ␣^{2} + u_{1} u_{2} ␣^{2} + u_{1} u_{3} ␣^{2} + u_{2} u_{3} ␣^{2}\right) + \\
&z \left(u_{0} ␣^{3} + u_{1} ␣^{3} + u_{2} ␣^{3} + u_{3} ␣^{3}\right) +\\
&␣^{4};
\end{split}
\end{displaymath}
(iii)~\textit{like objects in unlike boxes}
\begin{displaymath}
\begin{split}
&z^{4} \bullet^{4} + \\
&z^{3} \left(\bullet ␣ \bullet^{2} + \bullet^{2} ␣ \bullet + \bullet^{3} ␣ + ␣ \bullet^{3}\right) + \\
&z^{2} \left(\bullet ␣ \bullet ␣ + \bullet ␣^{2} \bullet + \bullet^{2} ␣^{2} + ␣ \bullet ␣ \bullet + ␣ \bullet^{2} ␣ + ␣^{2} \bullet^{2}\right) + \\
&z \left(\bullet ␣^{3} + ␣ \bullet ␣^{2} + ␣^{2} \bullet ␣ + ␣^{3} \bullet\right) +\\
&␣^{4}
\end{split}
\end{displaymath}
and (iv)~\textit{like objects in like boxes}
\begin{displaymath}
\circ^{4} z^{4} + 4 \circ^{3} z^{3} + 6 \circ^{2} z^{2} + 4 \circ z + 1
\end{displaymath}
respectively.
\end{example}

Previous example shows that each coefficient of $z^{i}$ in series expansions
denotes configurations using a summation, in particular each summand indicates
which object goes in which box; it was pretty symmetric, therefore the next
uses a different objects setting, though similar in the spirit.

\begin{example}
What's the occupancy configurations of $3$ boxes using $3$ objects
$o_{0}$,$o_{1}$ and $o_{2}$, where the first object may not or may be selected
for placement, the second may not or may be selected either one or two times
    and the third may not or may be selected either one or two or three times?

The answer lies in the semantic
\begin{displaymath}
    \semantic{\tycp{a}{\tycp{b}{c}}} = \left(z o_{0} + ␣\right) \left(z \left(z o_{1}^{2} + o_{1}\right) + ␣\right) \left(z \left(z^{2} o_{2}^{3} + z o_{2}^{2} + o_{2}\right) + ␣\right)
    \quad\text{where}
\end{displaymath}
\begin{displaymath}
\begin{split}
a&={\tymaybe{\typarens{\tyvar{o_{0}\,z}}}}, b={\tymaybe{\typarens{\tydu{\tyvar{o_{1}\,z}}{\tyvar{o_{1}^{2}\,z^{2}}}}}}\\
\quad&\text{and}\quad d={\tymaybe{\typarens{\tydu{\tyvar{o_{3}\,z}}{\tydu{\tyvar{o_{3}^{2}\,z^{2}}}{\tyvar{o_{3}^{3}\,z^{3}}}}}}},
\end{split}
\end{displaymath}
and its series expansion with respect to $z$ enumerates as follows,
according to the cases (i)~\textit{unlike objects in unlike boxes}
\begin{displaymath}
\begin{split}
&z^{6} o_{0} o_{1}^{2} o_{2}^{3} + \\
&z^{5} \left(o_{0} o_{1} o_{2}^{3} + o_{0} o_{1}^{2} o_{2}^{2} + ␣ o_{1}^{2} o_{2}^{3}\right) + \\
&z^{4} \left(o_{0} o_{1} o_{2}^{2} + o_{0} o_{1}^{2} o_{2} + o_{0} ␣ o_{2}^{3} + ␣ o_{1} o_{2}^{3} + ␣ o_{1}^{2} o_{2}^{2}\right) + \\
&z^{3} \left(o_{0} o_{1} o_{2} + o_{0} o_{1}^{2} ␣ + o_{0} ␣ o_{2}^{2} + ␣ o_{1} o_{2}^{2} + ␣ o_{1}^{2} o_{2} + ␣^{2} o_{2}^{3}\right) + \\
&z^{2} \left(o_{0} o_{1} ␣ + o_{0} ␣ o_{2} + ␣ o_{1} o_{2} + ␣ o_{1}^{2} ␣ + ␣^{2} o_{2}^{2}\right) + \\
&z \left(o_{0} ␣^{2} + ␣ o_{1} ␣ + ␣^{2} o_{2}\right) + \\
&␣^{3}
\end{split}
\end{displaymath}
(ii)~\textit{unlike objects in like boxes}
\begin{displaymath}
\begin{split}
&u_{0} u_{1}^{2} u_{2}^{3} z^{6} + \\
&z^{5} \left(u_{0} u_{1}^{2} u_{2}^{2} + u_{0} u_{1} u_{2}^{3} + u_{1}^{2} u_{2}^{3} ␣\right) + \\
&z^{4} \left(u_{0} u_{1}^{2} u_{2} + u_{0} u_{1} u_{2}^{2} + u_{0} u_{2}^{3} ␣ + u_{1}^{2} u_{2}^{2} ␣ + u_{1} u_{2}^{3} ␣\right) + \\
&z^{3} \left(u_{0} u_{1}^{2} ␣ + u_{0} u_{1} u_{2} + u_{0} u_{2}^{2} ␣ + u_{1}^{2} u_{2} ␣ + u_{1} u_{2}^{2} ␣ + u_{2}^{3} ␣^{2}\right) + \\
&z^{2} \left(u_{0} u_{1} ␣ + u_{0} u_{2} ␣ + u_{1}^{2} ␣^{2} + u_{1} u_{2} ␣ + u_{2}^{2} ␣^{2}\right) + \\
&z \left(u_{0} ␣^{2} + u_{1} ␣^{2} + u_{2} ␣^{2}\right) + \\
&␣^{3}
\end{split}
\end{displaymath}
(iii)~\textit{like objects in unlike boxes}
\begin{displaymath}
\begin{split}
&z^{6} \bullet^{6} + \\
&z^{5} \left(2 \bullet^{5} + ␣ \bullet^{5}\right) + \\
&z^{4} \left(\bullet ␣ \bullet^{3} + 2 \bullet^{4} + 2 ␣ \bullet^{4}\right) + \\
&z^{3} \left(\bullet ␣ \bullet^{2} + \bullet^{3} + \bullet^{3} ␣ + 2 ␣ \bullet^{3} + ␣^{2} \bullet^{3}\right) + \\
&z^{2} \left(\bullet ␣ \bullet + \bullet^{2} ␣ + ␣ \bullet^{2} + ␣ \bullet^{2} ␣ + ␣^{2} \bullet^{2}\right) + \\
&z \left(\bullet ␣^{2} + ␣ \bullet ␣ + ␣^{2} \bullet\right) + \\
&␣^{3}
\end{split}
\end{displaymath}
and (iv)~\textit{like objects in like boxes}
\begin{displaymath}
\circ^{6} z^{6} + 3 \circ^{5} z^{5} + 5 \circ^{4} z^{4} + 6 \circ^{3} z^{3} + 5 \circ^{2} z^{2} + 3 \circ z + 1
\end{displaymath}
respectively.
\end{example}

\begin{example}
Let $L,\alpha\in\mathcal{V}$ be pure symbols then consider the type
\begin{displaymath}
    \rec{L}{()\,|\,\tyvar{\alpha\,z}\times_{c}\tyvar{L}}
\end{displaymath}
whose generating function can be found by the semantic
\begin{displaymath}
    \semantic{\rec{L}{()\,|\,\tyvar{\alpha\,z}\times_{c}\tyvar{L}}} = \beta(z)
\end{displaymath}
where $\beta(z)$ is the solution of the equation
\begin{displaymath}
    \semantic{\tyvar{L}} = \semantic{()\,|\,\tyvar{\alpha\,z}\times_{c}\tyvar{L}}
\end{displaymath}
which reduces to solve
\begin{displaymath}
    L = 1 + \alpha\,z\,L\quad\text{with respect to $L$},
\end{displaymath}
therefore $\displaystyle L = \frac{1}{1 - \alpha\,z}$
so take $\displaystyle \beta(z) = \frac{1}{1 - \alpha\,z}$, as required.

A series expansion of $\beta(z)$ up to $10$ terms yields
\begin{displaymath}
\beta(z) = 1 + \alpha z + \alpha^{2} z^{2} + \alpha^{3} z^{3} + \alpha^{4} z^{4} + \alpha^{5} z^{5} + \alpha^{6} z^{6} + \alpha^{7} z^{7} + \alpha^{8} z^{8} + \alpha^{9} z^{9} + O\left(z^{10}\right)
\end{displaymath}
hence $[z^{n}]\,\semantic{\rec{L}{()\,|\,\tyvar{\alpha\,z}\times_{c}\tyvar{L}}} =
\alpha^{n}$ which says that there is $1$ composition of $n$ values having type
$\tyvar{\alpha\,z}$ each one of them.
\end{example}

The generalization of the previous type is so fundamental that we stick to it a name
\begin{displaymath}
\begin{split}
    \Gamma\quad::=\quad&... \\
           |\quad&\lst{\Gamma}\,\triangleq\,\rec{\mathcal{V}}{()\,|\,\Gamma\times_{c}\tyvar{\mathcal{V}}}\indent\textit{(list)}
\end{split}
\end{displaymath}
with semantic
\begin{displaymath}
    \semantic{\lst{a}} = \frac{1}{1-\semantic{a}},
\end{displaymath}
namely $\lst{\gamma}$ is the set of all (possibly infinite) lists of
objects with type $\gamma\in\Gamma$. Using it immediately we can add new types, such
as
\begin{displaymath}
\begin{split}
    \Gamma\quad::=\quad&... \\
           |\quad&\derangements{\Gamma}\,\triangleq\,(-1\cdot2)^{\Gamma}\times_{b}\lst{\Gamma}\indent\text{(derangements)}
\end{split}
\end{displaymath}
with semantic
\begin{displaymath}
    \semantic{\derangements{a}} = e^{-\semantic{a}}\star\frac{1}{1-\semantic{a}\,z}
\end{displaymath}

\section{Unlabelled structures}

\begin{minted}[baselinestretch=0.8]{python}
tyvar(x).gf()
\end{minted}
\begin{displaymath}
\left [ \mathcal{V}{\left (x \right )} = x\right ]
\end{displaymath}

\section{Labelled structures}

Before proceeding on our main track we recap some \emph{exponential} generating
functions and their series expansions, for the sake of clarity

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), z**3,ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = z^{3} = 6 z^{3};
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), exp(z),ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = e^{z} = 1 + z + z^{2} + z^{3} + z^{4} + z^{5} + z^{6} + z^{7} + z^{8} + z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), z*exp(z), ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = z e^{z} = z + 2 z^{2} + 3 z^{3} + 4 z^{4} + 5 z^{5} + 6 z^{6} + 7 z^{7} + 8 z^{8} + 9 z^{9} + O\left(z^{10}\right)
\end{displaymath}
which is the exponential dual of the ordinary expansion
\begin{minted}[baselinestretch=0.8]{python}
define(f(z), z*(1/(1-z))*(1/(1-z)),
       ctor=FEq).series(z,n=10,is_exp=False)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{z}{\left(- z + 1\right)^{2}} = z + 2 z^{2} + 3 z^{3} + 4 z^{4} + 5 z^{5} + 6 z^{6} + 7 z^{7} + 8 z^{8} + 9 z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), z**2*exp(z)/factorial(2,evaluate=False),
       ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{z^{2} e^{z}}{2!} = z^{2} + 3 z^{3} + 6 z^{4} + 10 z^{5} + 15 z^{6} + 21 z^{7} + 28 z^{8} + 36 z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), z**3*exp(z)/factorial(3, evaluate=False),
       ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{z^{3} e^{z}}{3!} = z^{3} + 4 z^{4} + 10 z^{5} + 20 z^{6} + 35 z^{7} + 56 z^{8} + 84 z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), (exp(z)+exp(-z))/2,
       ctor=FEq).series(z, n=20, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{e^{z}}{2} + \frac{e^{- z}}{2} = 1 + z^{2} + z^{4} + z^{6} + z^{8} + z^{10} + z^{12} + z^{14} + z^{16} + z^{18} + O\left(z^{20}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), exp(m*z), ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = e^{m z} = 1 + m z + m^{2} z^{2} + m^{3} z^{3} + m^{4} z^{4} + m^{5} z^{5} + m^{6} z^{6} + m^{7} z^{7} + m^{8} z^{8} + m^{9} z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), (exp(z)-1)/z, ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{e^{z} - 1}{z} = 1 + \frac{z}{2} + \frac{z^{2}}{3} + \frac{z^{3}}{4} + \frac{z^{4}}{5} + \frac{z^{5}}{6} + \frac{z^{6}}{7} + \frac{z^{7}}{8} + \frac{z^{8}}{9} + \frac{z^{9}}{10} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), 1/(1-z), ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{1}{- z + 1} = 1 + z + 2 z^{2} + 6 z^{3} + 24 z^{4} + 120 z^{5} + 720 z^{6} + 5040 z^{7} + 40320 z^{8} + 362880 z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), (1/(1-z))*(1/(1-z)), ctor=FEq).series(z, n=10,is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = \frac{1}{\left(- z + 1\right)^{2}} = 1 + 2 z + 6 z^{2} + 24 z^{3} + 120 z^{4} + 720 z^{5} + 5040 z^{6} + 40320 z^{7} + 362880 z^{8} + 3628800 z^{9} + O\left(z^{10}\right);
\end{displaymath}

\begin{minted}[baselinestretch=0.8]{python}
define(f(z), exp(z)**2, ctor=FEq).series(z, n=10, is_exp=True)
\end{minted}
\begin{displaymath}
f{\left (z \right )} = e^{2 z} = 1 + 2 z + 4 z^{2} + 8 z^{3} + 16 z^{4} + 32 z^{5} + 64 z^{6} + 128 z^{7} + 256 z^{8} + 512 z^{9} + O\left(z^{10}\right).
\end{displaymath}

\input{appendix.tex}
